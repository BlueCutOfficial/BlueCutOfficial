# Ember Guides in French 🇫🇷 - Following the changes in the official docs

This article is part of the "Ember Guides in French 🇫🇷" series that introduces the French translation project for the Ember Guides. If you want to know more about the context, read [the introduction article](./ember-guides-in-french-en.md). The present article will detail how we follow the new versions of the Ember Guides and apply the changes in both the translated and not translated files. It is going to be about learning some Git commands ;)

## Context

In the Ember Guides, you can navigate to the documentation of all Ember versions starting `1.10`. Maintaining such a documentation history would be too much work for our humble translation project, we will stick to the latest version.

But how do stay up to date? Let’s use the following scenario: we start the translation project right after Ember 4.11 docs are pushed on [Guides Source](https://github.com/ember-learn/guides-source). We translate 50% of the website, then the learning team makes a new tag for Ember 4.12 docs. How to identify each English file that has been added, removed, or modified between 4.11 and 4.12 so we can adjust our translation to the new content? How to handle this as smoothly as possible?

## 1. Set up `git` branches (only once)

### 1.1. Origin and Upstream 

So let's start the scenario. We start our translation project when the last commit on Guides Source is the 4.11 docs tag. To do so, we fork Guides Source using GitHub and we create a new repository `ember-[some language]-guides-source` under an organization we own. Once it is done, we clone our repository locally. In the project folder, when typing `git remote -v`, we have this kind of result:

```sh
git remote -v

origin  git@github.com:DazzlingFugu/ember-fr-guides-source.git (fetch)
origin  git@github.com:DazzlingFugu/ember-fr-guides-source.git (push)
upstream  git@github.com:ember-learn/guides-source.git (fetch)
upstream  git@github.com:ember-learn/guides-source.git (push)
```

The git repository is connected to two different resources: the origin and the upstream. Both are a history of commits that allow git to do its source control magic:

- "Origin" represents the actual repository of the git project. When you create a brand new project from scratch, you only have an origin.

- "Upstream" is the repository out of which the git project was created, it’s the forked repository.

Now that we have our `ember-[lng]-guides-source`, we need to prepare for the day the learning team will launch the next version of the docs.

###  1.2. Set up the “reference” branch

We can only compare English to English. When we translate a file to another language, the content becomes so different that Git can no longer make a relevant diff. Furthermore, as we maintain only one documentation version, we want to move the content of `guides/release/` to `guides/` directly (to delete the version selection dropdown generated by Guidemaker), so at some point our translated files won’t even have the same location as their English equivalent. So how can we keep a relevant git diff after we start the translation work?

We use a branch that is going to represent what we have translated exactly. Let’s call this branch `ref-upstream`. Right after we forked the repository, we immediately create a second branch that represents the English “state of the art”:

```sh
git checkout -b ref-upstream 
```

Now let’s go back to the `master` branch and start to work (change the dependencies, customize the pieces step by step, translate the docs...) While we merge PRs into `master` to build our translated website, `ref-upstream` will not change. It is only here to reflect what is the English equivalent of our website (in the present example, the 4.11 docs).

## 2. Manual process to upgrade the docs (repeat for each new version)

### 2.1. View the next version changes

The process I describe here is very manual, there could be shortcuts to get the same result faster. However, it’s a great opportunity to understand a bit about how git works and to control precisely everything.

Let's keep going with our scenario, we have translated 50% of the site and the Ember-learn releases the docs for Ember 4.12. We want to adjust our translation to the new content. To do so, we need to compare the content of the 4.12 tag to the English content we have translated. This content is located on our `ref-upstream` branch:

```sh
git checkout ref-upstream
git fetch upstream
git diff -R upstream/master -- guides/release > en.diff
```

First, we check out `ref-upstream` branch. Then, the second command downloads the content of the remote upstream so our local upstream's latest commit is the new 4.12 tag. The third command is the most complex and interesting one.

It’s a `git diff`. `git diff` shows how your changes impact `master`. The common scenario is that you write some code (to include a new feature or fix a bug) then you want to merge this code to the project’s `master` branch.

In our case, it's the opposite: we want to see what is new on the main branch `upstream/master` and how it impacts our `ref-upstream`. So we use `-R` option to reverse the diff direction.

There are a lot of UI and config differences between the official website and our website, and this is all noise we don’t care about. The only thing we are interested in is the latest docs. so we use `-- guides/release` to run the diff only for this folder. 

Last but not least, `>` is an output instruction, it prints the result of the command in the specified file. You can put any name here, I use the `.diff` extension because syntax highlighting tools will then show the added/removed lines nicely in my code editor.

We now have an `en.diff` file that shows exactly what the changes are between 4.11 and 4.12. The next step is to handle them.

### 2.2. Integrate the English changes

Let's create a working branch to do something with the diff:

```sh
git checkout master
git checkout -b catchup-x.x.x (the new Ember version)
git apply en.diff
```

First, we go back to `master` because we want the working branch to be in `master` state. Then we create the working branch. Finally, we run `git apply` followed by the diff file name.

This is what a block of our diff file looks like:

```diff
diff --git b/guides/release/models/finding-records.md a/guides/release/models/finding-records.md
index 57027feb..ef3de53b 100644
--- b/guides/release/models/finding-records.md
+++ a/guides/release/models/finding-records.md
@@ -119,7 +119,7 @@ tom = store.query('user', {
     email: 'tomster@example.com'
   }
 }).then(function(users) {
-  return users.get('firstObject');
+  return users[0]; // the first object
 });
```

We have the file path, the lines that have been removed prefixed with `-` and the lines that have been added prefixed with `+`. `git apply` will consider the files `a` and `b` and will automatically remove the lines to remove, and add the lines to add. Simple. But not so simple. This command is a failure for two reasons.

Reason 1. In `master` we moved the content of `guides/release` to `guides/` (we did this because we have only one version of the docs, the latest version. When files are located in `guides/release`, Guidemaker thinks that "old" docs are available and generate a dropdown to navigate between versions). This problem is pretty easy to solve. Use your code editor to "Find and replace" `guides/release` with `guides`, it simply changes the path of the file in which we want to apply `a` to `b`.

Reason 2. Remember in `master` the files are 50% translated. git can apply the modifications from `a` to `b` only if `b` still has the English content found during the comparison between `upstream` and `ref-upstream`. In other words, `git apply` automatically updates the English files that are yet to be translated. But when the translation is done, there's nothing to apply, it's up to you as a translator to take note of the change and adjust your translation accordingly.

### 2.3. Integrate the [your language] changes

Each time `git apply` fails, you need to remove the problematic diff block that killed the process and then re-run `git apply` until it succeeds (meaning that all 50% of the English files have been automatically updated).

It's really up to you how to handle that, here is the manual process for the French Guides: if the change is very simple, we apply it directly in the catchup branch then we remove the diff block. If the change requires a bit of rework on the corresponding translated file, we handle it separately by opening a GitHub issue for a later time. Once the issue is open, we remove the diff block.

GitHub has an "issue template" feature that allows you to open an issue with a predefined layout. In `ember-fr-guides-source`, our template [looks like this](https://github.com/DazzlingFugu/ember-fr-guides-source/blob/master/.github/ISSUE_TEMPLATE/file-to-translate.md). We copy the diff block in the issue to keep track of the original English change.

Also, if you encounter an issue worded `guides/[path].md: No such file or directory`, it means a brand new file has been added to the official guide, so you need to add it on your side to start its translation. The opposite way,  

### 2.4. Prepare for the next run

Now, the version you are translating is 4.12. Make sure to update the branch `ref-upstream` for the next Ember version:

```sh
git checkout ref-upstream
git reset --hard upstream/master
git push origin -f ref-upstream
```

And here you are. That's the manual process to follow the official docs update. It's a bit convoluted at first reading, but once you have it in mind it can be fast enough. However, some automation tools would be more than welcome.